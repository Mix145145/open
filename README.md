# Tuposcan (Raspberry Pi 4B + IMX477)

Проект предназначен для работы на Raspberry Pi 4B с камерой Sony IMX477, подключенной через CSI, и 3D‑принтером, подключённым через USB‑серийный порт.

## Быстрый старт на «нулевой» Raspberry Pi

1. **Обновите систему и установите Python**:
   ```bash
   sudo apt update
   sudo apt install -y python3 python3-venv python3-pip
   ```

2. **Включите CSI‑камеру** (если ещё не включена):
   ```bash
   sudo raspi-config
   ```
   В меню выберите **Interface Options → Camera → Enable**, затем перезагрузите устройство.

3. **Склонируйте проект и создайте окружение**:
   ```bash
   git clone <URL-репозитория>
   cd tuposcan
   python3 -m venv .venv
   source .venv/bin/activate
   ```

4. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

5. **Запуск**:
   ```bash
   python3 main.py
   ```

> Для Raspberry Pi рекомендуется установить `picamera2` через `apt`, чтобы приложение могло
> получать кадры напрямую через libcamera (это помогает, когда `rpicam-hello` работает, а
> OpenCV не видит камеру).

## Настройки

- **Сериал порт**: выберите USB‑порт 3D‑принтера (например, `/dev/ttyUSB0` или `/dev/ttyACM0`).
- **Разрешение**: для IMX477 рекомендуется `3840x2160` (4K). Поле зрения (FOV) может отличаться от прежнего — задайте его вручную в профиле фокуса.
- **Профили сканирования**: создайте профиль с названием и размерами (Ш × В, мм), например `Заготовка 200x200`.
- **Профили фокуса**: задают высоту Z и приблизительный FOV для выбранной высоты. Можно двигать Z вверх/вниз и сохранить профиль.
- **Проверить фокус**: принтер едет в центр (X54 Y110) на Z из выбранного профиля фокуса.
- **Предпросмотр камеры**: открывается из раздела «Настройки», чтобы видеть изображение во время настройки фокуса.

Все настройки сохраняются в `aruco_calib.json` рядом с файлом проекта.

## Документация по camtest.py

Для проверки камеры и измерения FPS используйте `camtest.py`. Полная инструкция по запуску,
параметрам и чтению отчёта находится в отдельном документе: [CAMTEST.md](CAMTEST.md).
